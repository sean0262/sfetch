#!/bin/bash
distro=$(cat /etc/os-release | head -1 | sed 's/"//g' | cut -d= -f2)
kernel=$(uname -r)
shell=$(echo `$SHELL --version` | cut -d'(' -f1)
uptime=$(uptime -p)
memory=$(free -hm | awk 'NR==2{printf "%s/%s\n", $3,$2}')
vn=$(echo "0.0.8a")

declare -A osInf;
osInf[/etc/redhat-release]=yum
osInf[/etc/arch-release]=pacman
osInf[/etc/gentoo-release]=emerge
osInf[/etc/SuSE-release]=zypp
osInf[/etc/debian_release]=apt-get
osInf[/etc/ubuntu-release]=apt-get
osInf[/etc/debian_version]=apt-get

# Arguments . . .
if [ "$1" == "--PM" ] || [ "$1" == "--Package-Manager" ]; then
	for f in ${!osInf[@]}
	do
		if [[ -f $f ]];then
			echo "$(${osInf[$f]})"
		fi
	done
elif [ "$1" == "--help" ] || [ "$1" == "-h" ]; then
	echo "Available Arguments:"
	echo "Package Manager [--PM]	Displays Package Manager"
	echo "Help [-h][--help]	Displays Available Arguments"
	echo "Version [--version]	Displays Current sfetch Version"
elif [ "$1" == "--version" ]; then
	echo "version $vn"
fi


# Information-check . . .
if [[ $# -eq 0 ]] ; then
	host=$(cat /sys/devices/virtual/dmi/id/product_name /sys/devices/virtual/dmi/id/product_version | tr '\n' ' ')
	
	if [[ $distro =~ "Debian" ]] || [[ $distro =~ "Ubuntu" ]] || [[ $distro =~ "Raspbian" ]]  
	then
  		packages=$(dpkg-query -W | wc -l)
	fi

	if [[ $distro =~ "Raspbian" ]]
	then
		host=$(cat /sys/firmware/devicetree/base/model | echo "\n")
	fi

	if [[ $distro =~ "Slackware" ]] 
	then
  		packages=$(ls /var/log/packages | wc -l)
	fi

	if [ -n "$XDG_CURRENT_DESKTOP" ]; then
		de=$(echo "$XDG_CURRENT_DESKTOP")
	else
  		de=$(echo "None")
	fi

	if [ -n "$GDMSESSION" ]; then
  		session=$(echo "$GDMSESSION")
	else
  		session=$(echo "None")
	fi


	echo "OS: $distro"
	echo "DE: $de"
	echo "Host: $host"
	echo "Kernel: $kernel"
	echo "Shell: $shell"
	echo "Uptime: $uptime"
	# echo "Packages: $packages"
	# echo "Session: $session"
	echo "Memory: $memory"
fi
